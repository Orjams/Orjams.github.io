<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>某国赛的wp | Orjams' Blog</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><script src="/js/third-party/jquery.min.js">           </script><script src="/js/third-party/velocity.min.js">           </script><script src="/js/third-party/velocity.ui.min.js">           </script><link rel="icon" href="/img/favicon.ico"></head><body><nav id="nav-bar"><nav class="clear-fix" id="nav-container"><div class="pull-left" id="page-home"><a href="/">Orjams' Blog</a></div><i class="fa fa-bars pull-right" id="toggle-nav" aria-hidden="true"></i><ul class="pull-right" id="navs"><li><a class="nav" href="/">Home</a></li><li><a class="nav" href="/about">About</a></li></ul></nav></nav><header id="header-info"><div id="header-container"><div id="site-info"><div id="terminal-pl"><div id="top-bar"><ul id="control"><li class="btn"></li><li class="btn"></li><li class="btn"></li></ul><div id="file-path"><i class="fa fa-folder folder-ic" aria-hidden="true"></i> Orjamss 10 X 10</div></div><div id="code-pl">Last updated: 2018-08-14<br>Orjamss:~ Desktop$ <span class="code-pl-input">node 某国赛的wp.js</span><br><br>> game.typ<br><br><br>> game.val<br><br><br>> game.tags <br><a class="tag" href="#CTF WriteUp"><span>CTF WriteUp</span></a><br><br>> game.prev <br><a href="/2018/08/14/pwn入门的两道题/"><span class="answer">pwn入门的两道题</span></a><br><br>> game.next <br><a href="/2018/08/14/3道RSA/"><span class="answer">3道RSA的题解</span></a></div></div></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><a class="article-title">某国赛的wp</a><time class="article-date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-08-14</time><h2 id="10-0-0-55-Writeup"><a href="#10-0-0-55-Writeup" class="headerlink" title="10.0.0.55 Writeup"></a>10.0.0.55 Writeup</h2><p>之前和几个师傅一起打了国赛，名次是能够晋级的，但最后由于队伍的原因没能晋级，但看大佬们上分也很爽啊，把wp发上去再重温一下吧。</p>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="0x01-easyweb"><a href="#0x01-easyweb" class="headerlink" title="0x01 easyweb"></a>0x01 easyweb</h4><h5 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h5><p>题目很脑洞<br>用户名admin 密码123456进去可得到flag(密码现在换了）<br><a id="more"></a><br><img src="http://wx2.sinaimg.cn/mw690/0060lm7Tly1fqtst807h2j30rk0ckt8x.jpg" alt=""></p>
<h5 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h5><p>无</p>
<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><h4 id="0x02-2ex"><a href="#0x02-2ex" class="headerlink" title="0x02 2ex"></a>0x02 2ex</h4><h5 id="解题思路-1"><a href="#解题思路-1" class="headerlink" title="解题思路"></a>解题思路</h5><p>题目给了一个ELF和一个out文件, out文件</p>
<p>运行ELF文件, 发现它会根据我的输入给出对应输出, 格式与out文件中的内容相仿</p>
<p>尝试直接爆破, 得到flag: <strong>flag{change53233}</strong></p>
<h5 id="解题脚本-1"><a href="#解题脚本-1" class="headerlink" title="解题脚本"></a>解题脚本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'error'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(flag)</span>:</span></span><br><span class="line">    io = process(<span class="string">'qemu-mips mx'</span>, shell=<span class="keyword">True</span>)</span><br><span class="line">    io.sendline(flag)</span><br><span class="line">    ret = io.recv().decode()</span><br><span class="line">    io.close()</span><br><span class="line">    <span class="keyword">return</span> ret.strip()</span><br><span class="line"></span><br><span class="line">enc = <span class="string">'_r-+_Cl5;vgq_pdme7#7eC0='</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(flag)</span>:</span></span><br><span class="line">    n = len(flag) // <span class="number">3</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> printable:</span><br><span class="line">        ret = send(<span class="string">''</span>.join(flag + [c]))</span><br><span class="line">        <span class="keyword">if</span> ret[<span class="number">0</span>:len(flag)+n+<span class="number">1</span>] == enc[<span class="number">0</span>:len(flag)+n+<span class="number">1</span>]:</span><br><span class="line">            print(<span class="string">''</span>.join(flag + [c]))</span><br><span class="line">            <span class="keyword">if</span> c != <span class="string">'&#125;'</span>:</span><br><span class="line">                solve(flag + [c])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                exit()</span><br><span class="line"></span><br><span class="line">solve([])</span><br></pre></td></tr></table></figure>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="0x03-crackme-c"><a href="#0x03-crackme-c" class="headerlink" title="0x03 crackme-c"></a>0x03 crackme-c</h4><h5 id="解题思路-2"><a href="#解题思路-2" class="headerlink" title="解题思路"></a>解题思路</h5><p>题目给了一个64位ELF文件, 拖入IDA分析</p>
<p>发现该程序接受一个16位字符串, 然后用以下函数加密后与密文比较</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">encrypt</span><span class="params">(<span class="keyword">const</span> <span class="keyword">void</span> *flag, <span class="keyword">char</span> *enc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 j; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 k; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memcpy</span>(enc, flag, <span class="number">16u</span>LL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0L</span>L; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    shuffle(enc);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0L</span>L; j &lt;= <span class="number">3</span>; ++j )</span><br><span class="line">      *(_DWORD *)&amp;enc[<span class="number">4</span> * j] = another_wtf_array[((<span class="number">4</span> * j + <span class="number">3</span> + <span class="number">16</span> * i) &lt;&lt; <span class="number">8</span>) + (<span class="keyword">unsigned</span> __int8)enc[<span class="number">4</span> * j + <span class="number">3</span>]] ^ another_wtf_array[((<span class="number">4</span> * j + <span class="number">2</span> + <span class="number">16</span> * i) &lt;&lt; <span class="number">8</span>) + (<span class="keyword">unsigned</span> __int8)enc[<span class="number">4</span> * j + <span class="number">2</span>]] ^ another_wtf_array[((<span class="number">4</span> * j + <span class="number">1</span> + <span class="number">16</span> * i) &lt;&lt; <span class="number">8</span>) + (<span class="keyword">unsigned</span> __int8)enc[<span class="number">4</span> * j + <span class="number">1</span>]] ^ another_wtf_array[((<span class="number">4</span> * j + <span class="number">16</span> * i) &lt;&lt; <span class="number">8</span>) + (<span class="keyword">unsigned</span> __int8)enc[<span class="number">4</span> * j]];</span><br><span class="line">  &#125;</span><br><span class="line">  result = shuffle(enc);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0L</span>L; k &lt;= <span class="number">15</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    result = wtf_array[<span class="number">256</span> * k + (<span class="keyword">unsigned</span> __int8)enc[k]];</span><br><span class="line">    enc[k] = result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>大部分步骤可以通过逆操作还原, 但异或的部分不好处理</p>
<p>由数据特征, 得知enc的值应该在0~255之间, 针对每个异或的爆破次数最多为2**32次,可以接受</p>
<p>编写脚本进行还原, 得到flag：<strong>CISCNt8z@foQ-891</strong></p>
<h5 id="解题脚本-2"><a href="#解题脚本-2" class="headerlink" title="解题脚本"></a>解题脚本</h5><p>爆破异或<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"another_wtf_array.c"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> _i = atoi(argv[<span class="number">1</span>]), _j = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">unsigned</span> _raw = strtoul(argv[<span class="number">3</span>], <span class="literal">NULL</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">//printf("%d %d %d\n", _i, _j, _raw);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">256</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">256</span>; k++) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; <span class="number">256</span>; l++) &#123;</span><br><span class="line">                    <span class="keyword">int</span> base = <span class="number">4</span> * _j + <span class="number">16</span> * _i;</span><br><span class="line">                    <span class="keyword">unsigned</span> tmp = wtf[((base + <span class="number">3</span>) &lt;&lt; <span class="number">8</span>) + i] ^</span><br><span class="line">                        wtf[((base + <span class="number">2</span>) &lt;&lt; <span class="number">8</span>) + j] ^</span><br><span class="line">                        wtf[((base + <span class="number">1</span>) &lt;&lt; <span class="number">8</span>) + k] ^</span><br><span class="line">                        wtf[((base + <span class="number">0</span>) &lt;&lt; <span class="number">8</span>) + l];</span><br><span class="line">                    <span class="keyword">if</span> (tmp == _raw) &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">"%d-%d-%d-%d\n"</span>, l, k, j, i);</span><br><span class="line">                        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ast <span class="keyword">import</span> literal_eval</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./CISCN/wtf_array'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    wtf_array = literal_eval(f.read())</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'./CISCN/another_wtf_array'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    another_wtf_array = literal_eval(f.read())</span><br><span class="line">final_enc = [<span class="number">0xC3</span>, <span class="number">0xB1</span>, <span class="number">0x3</span>, <span class="number">0xFB</span>, <span class="number">0x2A</span>, <span class="number">0xAC</span>, <span class="number">0x46</span>, <span class="number">0x4B</span>, <span class="number">0x7C</span>, <span class="number">0xEE</span>, <span class="number">0xC7</span>,</span><br><span class="line">       <span class="number">0x74</span>, <span class="number">0x5D</span>, <span class="number">0x6D</span>, <span class="number">0xBE</span>, <span class="number">0x24</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shuffle</span><span class="params">(a)</span>:</span></span><br><span class="line">    a1 = a[:]</span><br><span class="line">    v2 = a1[<span class="number">1</span>]</span><br><span class="line">    a1[<span class="number">1</span>] = a1[<span class="number">5</span>] <span class="comment">#第二列下移</span></span><br><span class="line">    a1[<span class="number">5</span>] = a1[<span class="number">9</span>]</span><br><span class="line">    a1[<span class="number">9</span>] = a1[<span class="number">13</span>]</span><br><span class="line">    a1[<span class="number">13</span>] = v2</span><br><span class="line"></span><br><span class="line">    v3 = a1[<span class="number">2</span>] <span class="comment">#第一,三行的第三列交换</span></span><br><span class="line">    a1[<span class="number">2</span>] = a1[<span class="number">10</span>]</span><br><span class="line">    a1[<span class="number">10</span>] = v3</span><br><span class="line"></span><br><span class="line">    v4 = a1[<span class="number">6</span>] <span class="comment">#第二,四行的第三列交换</span></span><br><span class="line">    a1[<span class="number">6</span>] = a1[<span class="number">14</span>]</span><br><span class="line">    a1[<span class="number">14</span>] = v4</span><br><span class="line"></span><br><span class="line">    v5 = a1[<span class="number">3</span>] <span class="comment">#第四列下移</span></span><br><span class="line">    a1[<span class="number">3</span>] = a1[<span class="number">15</span>]</span><br><span class="line">    a1[<span class="number">15</span>] = a1[<span class="number">11</span>]</span><br><span class="line">    a1[<span class="number">11</span>] = a1[<span class="number">7</span>]</span><br><span class="line">    a1[<span class="number">7</span>] = v5</span><br><span class="line">    </span><br><span class="line">    result = v5</span><br><span class="line">    <span class="keyword">return</span> a1</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_shuffle</span><span class="params">(array)</span>:</span></span><br><span class="line">    a = array[:]</span><br><span class="line">    l = shuffle(list(range(<span class="number">16</span>)))</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tmp</span><span class="params">(x)</span>:</span></span><br><span class="line">        <span class="keyword">nonlocal</span> n</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> l[n - <span class="number">1</span>]</span><br><span class="line">    a.sort(key=tmp)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span><span class="params">(i, j, final)</span>:</span></span><br><span class="line">    final = final[<span class="number">0</span>] &lt;&lt; <span class="number">24</span> | final[<span class="number">1</span>] &lt;&lt; <span class="number">16</span> | final[<span class="number">2</span>] &lt;&lt; <span class="number">8</span> | final[<span class="number">3</span>]</span><br><span class="line">    raw = subprocess.Popen([<span class="string">'./CISCN/woc'</span>, str(i), str(j), str(final)], stdout=subprocess.PIPE).stdout.read()</span><br><span class="line">    <span class="keyword">return</span> [int(x) <span class="keyword">for</span> x <span class="keyword">in</span> raw.decode().strip().split(<span class="string">'-'</span>)]</span><br><span class="line">    </span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(len(enc)):</span><br><span class="line">    tmp_array = wtf_array[<span class="number">256</span>*_:<span class="number">256</span>*_+<span class="number">256</span>]</span><br><span class="line">    result.append([tmp_array.index(i) <span class="keyword">for</span> i <span class="keyword">in</span> tmp_array <span class="keyword">if</span> i==final_enc[_]][<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line">enc = re_shuffle(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>)[::<span class="number">-1</span>]:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">4</span>)[::<span class="number">-1</span>]:</span><br><span class="line">        print(<span class="string">f'\r<span class="subst">&#123;i&#125;</span>-<span class="subst">&#123;j&#125;</span>'</span>, end=<span class="string">''</span>)</span><br><span class="line">        enc[<span class="number">4</span>*j:<span class="number">4</span>*j+<span class="number">4</span>] = decrypt(i, j, enc[<span class="number">4</span>*j:<span class="number">4</span>*j+<span class="number">4</span>][::<span class="number">-1</span>])</span><br><span class="line">    enc = re_shuffle(enc)</span><br><span class="line"></span><br><span class="line">print(<span class="string">''</span>.join(chr(i) <span class="keyword">for</span> i <span class="keyword">in</span> enc))</span><br></pre></td></tr></table></figure>
<h4 id="0x04-flag-in-your-hand"><a href="#0x04-flag-in-your-hand" class="headerlink" title="0x04 flag_in_your_hand"></a>0x04 flag_in_your_hand</h4><h5 id="解题思路-3"><a href="#解题思路-3" class="headerlink" title="解题思路"></a>解题思路</h5><p>在script-min.js中可以看到ck函数，关键部分如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var a = [<span class="number">123</span>, <span class="number">101</span>, <span class="number">120</span>, <span class="number">48</span>, <span class="number">118</span>, <span class="number">104</span>, <span class="number">102</span>, <span class="number">120</span>, <span class="number">117</span>, <span class="number">108</span>, <span class="number">119</span>, <span class="number">124</span>];</span><br><span class="line"><span class="keyword">if</span> (s.length == a.length) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; s.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (a[i] - s.charCodeAt(i) != <span class="number">3</span>)</span><br><span class="line">            <span class="keyword">return</span> ic = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> ic = <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>于是写脚本算出s = “xbu-security”,放进index.html。</p>
<p>得到flag : <strong>l4uuMkiAk+MC13vLwGjhFg</strong></p>
<h5 id="解题脚本-3"><a href="#解题脚本-3" class="headerlink" title="解题脚本"></a>解题脚本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">123</span>, <span class="number">101</span>, <span class="number">120</span>, <span class="number">48</span>, <span class="number">118</span>, <span class="number">104</span>, <span class="number">102</span>, <span class="number">120</span>, <span class="number">117</span>, <span class="number">108</span>, <span class="number">119</span>, <span class="number">124</span>]</span><br><span class="line">s = [ chr(i<span class="number">-3</span>) <span class="keyword">for</span> i <span class="keyword">in</span> a ]</span><br><span class="line"><span class="keyword">print</span> <span class="string">''</span>.join(s)</span><br></pre></td></tr></table></figure>
<h4 id="0x05-sm"><a href="#0x05-sm" class="headerlink" title="0x05 sm"></a>0x05 sm</h4><h5 id="解题思路-4"><a href="#解题思路-4" class="headerlink" title="解题思路"></a>解题思路</h5><p>拿到题目发现flag被一个AES加密，加密的秘钥使我们要攻克的地方，同时看到生成了512个随机数，秘钥是一个512位二进制数，并对由秘钥指定的一部分随机数异或起来。本来认为这是一个数学上的题目，但是仔细观察发现，这512个随机数最后若干位全是0，且0的个数彼此都不相同，那么异或结果的最后一位仅与最后没有0的随机数有关，在确定最后没有0的随机数是否使用后，可运用相同的方式处理倒数第二位。最后还原出秘钥，通过AES解密后得到<strong>flag{shemir_alotof_in_wctf_fun!}</strong>。</p>
<h5 id="解题脚本-4"><a href="#解题脚本-4" class="headerlink" title="解题脚本"></a>解题脚本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">"ps"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">	nums = f.read().split()</span><br><span class="line">	nums = list(map(<span class="keyword">lambda</span> a: int(a), nums))</span><br><span class="line">	group = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"r"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line">	final = int(f.read())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">zeros</span><span class="params">(num)</span>:</span></span><br><span class="line">	rev = bin(num)[<span class="number">2</span>:][::<span class="number">-1</span>]</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>):</span><br><span class="line">		<span class="keyword">if</span>(rev[i] == <span class="string">'1'</span>): <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">num2bin</span><span class="params">(num)</span>:</span></span><br><span class="line">	bnum = bin(num)[<span class="number">2</span>:]</span><br><span class="line">	bnum = <span class="string">'0'</span>*(<span class="number">512</span>-len(bnum)) + bnum</span><br><span class="line">	<span class="keyword">return</span> bnum</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> enumerate(nums):</span><br><span class="line">	z = zeros(num[<span class="number">1</span>])</span><br><span class="line">	<span class="keyword">if</span> group[z]: <span class="keyword">raise</span> Exception(<span class="string">'gg'</span>)</span><br><span class="line">	group[z] = num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xorer = <span class="number">0</span></span><br><span class="line">secret = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>)]</span><br><span class="line"></span><br><span class="line">bfinal = num2bin(final)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">511</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">	bxorer = num2bin(xorer)</span><br><span class="line">	<span class="keyword">if</span>(bxorer[i] != bfinal[i]):</span><br><span class="line">		xorer = xorer ^ group[<span class="number">511</span>-i][<span class="number">1</span>]</span><br><span class="line">		secret[group[<span class="number">511</span>-i][<span class="number">0</span>]] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">check_xor = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">512</span>):</span><br><span class="line">	<span class="keyword">if</span> secret[i]:</span><br><span class="line">		check_xor = nums[i] ^ check_xor</span><br><span class="line"></span><br><span class="line">print(check_xor == final)</span><br><span class="line"><span class="comment">#验证</span></span><br><span class="line">secret_int = int(<span class="string">''</span>.join(map(<span class="keyword">lambda</span> a:str(a), secret)),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,long_to_bytes,bytes_to_long</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">key=long_to_bytes(int(hashlib.md5(long_to_bytes(secret_int)).hexdigest(),<span class="number">16</span>))</span><br><span class="line">aes_obj = AES.new(key, AES.MODE_ECB)</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"ef"</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">	enc_flag = base64.b64decode(f.read().encode())</span><br><span class="line">print(aes_obj.decrypt(enc_flag))</span><br></pre></td></tr></table></figure>
<h4 id="0x06-oldstreamgame"><a href="#0x06-oldstreamgame" class="headerlink" title="0x06 oldstreamgame"></a>0x06 oldstreamgame</h4><h5 id="解题思路-5"><a href="#解题思路-5" class="headerlink" title="解题思路"></a>解题思路</h5><p>分析得知flag最多有2**32种可能, 可以接受, 尝试爆破</p>
<p>得到的数字转成16进制, 得到 <strong>flag{926201d7}</strong></p>
<h5 id="解题代码"><a href="#解题代码" class="headerlink" title="解题代码"></a>解题代码</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="comment">// gcc -fopenmp -O3 another.c -o another&amp;&amp;./another</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> enc[] = &#123;<span class="number">32</span>, <span class="number">253</span>, <span class="number">238</span>, <span class="number">248</span>, <span class="number">164</span>, <span class="number">201</span>, <span class="number">244</span>, <span class="number">8</span>, <span class="number">63</span>, <span class="number">51</span>, <span class="number">29</span>, <span class="number">168</span>, <span class="number">35</span>, <span class="number">138</span>, <span class="number">229</span>, <span class="number">237</span>, <span class="number">8</span>, <span class="number">61</span>, <span class="number">240</span>, <span class="number">203</span>, <span class="number">14</span>, <span class="number">122</span>, <span class="number">131</span>, <span class="number">53</span>, <span class="number">86</span>, <span class="number">150</span>, <span class="number">52</span>, <span class="number">93</span>, <span class="number">244</span>, <span class="number">77</span>, <span class="number">124</span>, <span class="number">24</span>, <span class="number">108</span>, <span class="number">31</span>, <span class="number">69</span>, <span class="number">155</span>, <span class="number">206</span>, <span class="number">19</span>, <span class="number">95</span>, <span class="number">29</span>, <span class="number">182</span>, <span class="number">199</span>, <span class="number">103</span>, <span class="number">117</span>, <span class="number">213</span>, <span class="number">220</span>, <span class="number">186</span>, <span class="number">183</span>, <span class="number">167</span>, <span class="number">131</span>, <span class="number">228</span>, <span class="number">138</span>, <span class="number">32</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">202</span>, <span class="number">37</span>, <span class="number">194</span>, <span class="number">47</span>, <span class="number">96</span>, <span class="number">174</span>, <span class="number">98</span>, <span class="number">179</span>, <span class="number">125</span>, <span class="number">232</span>, <span class="number">228</span>, <span class="number">5</span>, <span class="number">120</span>, <span class="number">227</span>, <span class="number">167</span>, <span class="number">120</span>, <span class="number">126</span>, <span class="number">180</span>, <span class="number">41</span>, <span class="number">115</span>, <span class="number">13</span>, <span class="number">149</span>, <span class="number">201</span>, <span class="number">225</span>, <span class="number">148</span>, <span class="number">66</span>, <span class="number">136</span>, <span class="number">235</span>, <span class="number">62</span>, <span class="number">46</span>, <span class="number">116</span>, <span class="number">125</span>, <span class="number">130</span>, <span class="number">22</span>, <span class="number">164</span>, <span class="number">120</span>, <span class="number">85</span>, <span class="number">7</span>, <span class="number">161</span>, <span class="number">55</span>, <span class="number">180</span>, <span class="number">19</span>, <span class="number">205</span>, <span class="number">105</span>, <span class="number">12</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> i, j, a, R, tmp, out, output, _i, lastbit;</span><br><span class="line">    <span class="keyword">unsigned</span> mask = <span class="number">2751989908L</span>;</span><br><span class="line">    <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> omp parallel</span></span><br><span class="line">    <span class="keyword">for</span> (a = <span class="number">0</span>; a &lt;= <span class="number">0xFFFFFFFF</span>; a++) &#123;</span><br><span class="line">        flag = <span class="literal">false</span>;</span><br><span class="line">        R = a;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            tmp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">                output = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">                _i = (R &amp; mask) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">                lastbit = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (_i != <span class="number">0</span>) &#123;</span><br><span class="line">                    lastbit ^= (_i &amp; <span class="number">1</span>);</span><br><span class="line">                    _i &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                output ^= lastbit;</span><br><span class="line"></span><br><span class="line">                R = output, out = lastbit;</span><br><span class="line">                tmp = (tmp &lt;&lt; <span class="number">1</span>) ^ out;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (enc[i] != tmp) &#123;</span><br><span class="line">                flag = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!flag) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%u\n"</span>, a);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="0x07-picture"><a href="#0x07-picture" class="headerlink" title="0x07 picture"></a>0x07 picture</h4><h5 id="解题思路-6"><a href="#解题思路-6" class="headerlink" title="解题思路"></a>解题思路</h5><p>用binwalk扫一下没毛病，用010打开搜jpg文件尾FFD9时发现后面还有一堆数据。</p>
<p>于是binwalk -e分离，将数据尝试base64解码，发现PK字样，联想到压缩包，但是格式有问题。将开头K和P互换之后尝试解压，需要密码，如下图。</p>
<p> <img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1fqtstkvuj8j30jt05laf1.jpg" alt="pictue"></p>
<p>提示password是一个python的除零报错，内容是integer division or modulo by zero，即密码。</p>
<p>解压成功得到code文件，file一下发现是uuencoded or xxencoded，于是将</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G0TE30TY[,$,R-S8S,D0V,#(V0D8U,S$R1#5!0S%!,T1&amp;-3-#1D)]</span><br></pre></td></tr></table></figure>
<p>尝试解码，发现是uuencode，得到<strong>CISCN{0C27632D6026BF5312D5AC1A3DF53CFB}</strong>。</p>
<h5 id="解题脚本-5"><a href="#解题脚本-5" class="headerlink" title="解题脚本"></a>解题脚本</h5><p>无</p>
<h4 id="0x08-验证码"><a href="#0x08-验证码" class="headerlink" title="0x08 验证码"></a>0x08 验证码</h4><p>签到拿flag</p>
<p><img src="http://wx3.sinaimg.cn/mw690/0060lm7Tly1fqtss9i8o4j30gn09z3yo.jpg" alt=""></p>
<h4 id="0x09-run"><a href="#0x09-run" class="headerlink" title="0x09 run"></a>0x09 run</h4><h5 id="解题思路-7"><a href="#解题思路-7" class="headerlink" title="解题思路"></a>解题思路</h5><p>python jail类型的题目, 很有趣</p>
<p>题目过滤了大量关键词如 ls exec 并且import几乎完全失效</p>
<p>Google得知可以通过().<strong>class</strong>.<strong>bases</strong>[0].<strong>subclasses</strong>()获取当前加载的类</p>
<p>再通过catch_warnings类进行代码执行, 依葫芦画瓢写出代码, getshell</p>
<p>得到flag: <strong>ciscn{d5333cdda7d7015818c39370958eabc2}</strong></p>
<h5 id="解题代码-1"><a href="#解题代码-1" class="headerlink" title="解题代码"></a>解题代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">w = ().__class__.__bases__[<span class="number">0</span>].__subclasses__()</span><br><span class="line">o =  w[<span class="number">59</span>].__enter__.__func__.__getattribute__(<span class="string">'__global'</span> + <span class="string">'s__'</span>)[<span class="string">'s'</span>+<span class="string">'ys'</span>].modules[<span class="string">'o'</span>+<span class="string">'s'</span>]</span><br><span class="line">s = o.__getattribute__(<span class="string">'sy'</span> + <span class="string">'stem'</span>)</span><br><span class="line">s(<span class="string">'/bin/sh'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="0x10-验证码破解-增强版"><a href="#0x10-验证码破解-增强版" class="headerlink" title="0x10 验证码破解-增强版"></a>0x10 验证码破解-增强版</h4><h5 id="解题思路-8"><a href="#解题思路-8" class="headerlink" title="解题思路"></a>解题思路</h5><p>这题我们用的是非预期解，四个人在四台电脑上同时答题，得到flag。</p>
<p><strong>ciscn{h171ghlh7byd1dyl7h277hr2irhb1ffg}</strong></p>
<p><img src="http://wx1.sinaimg.cn/mw690/0060lm7Tly1fqtstxvho6j30pn086k1z.jpg" alt="pijie"></p>
<h5 id="解题脚本-6"><a href="#解题脚本-6" class="headerlink" title="解题脚本"></a>解题脚本</h5><p>无</p>
</article><nav id="pagination"><div class="pagination clear-fix"><div class="page-prev pull-left"><a href="/2018/08/14/pwn入门的两道题/"><i class="fa fa-chevron-left"> </i><span>pwn入门的两道题</span></a></div><div class="page-next pull-right"><a href="/2018/08/14/3道RSA/"><span>3道RSA的题解</span><i class="fa fa-chevron-right"></i></a></div></div></nav></div></div><footer><div id="footer-inner"><div class="social-icons"></div><p class="design-info">power by <a href="https://hexo.io" target="_blank">Hexo</a> | theme <a href="https://github.com/lazysheep666/terminal_theme" target="_blank">Teminal</a></p><p class="copyright">Copyright © Orjamss Blog 2018</p></div></footer><script src="/js/nav.js"></script><script src="/js/scroll.js"></script><script src="/js/index.js"></script></body></html>